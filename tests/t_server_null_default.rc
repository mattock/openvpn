srcdir="${srcdir:-.}"
top_builddir="${top_builddir:-..}"
sample_keys="${sample_keys:-${top_builddir}/sample/sample-keys}"

DH="${DH:-${sample_keys}/dh2048.pem}"
CA="${CA:-${sample_keys}/ca.crt}"
CLIENT_CERT="${CLIENT_CERT:-${sample_keys}/client.crt}"
CLIENT_KEY="${CLIENT_KEY:-${sample_keys}/client.key}"
SERVER_CERT="${SERVER_CERT:-${sample_keys}/server.crt}"
SERVER_KEY="${server_key:-${sample_keys}/server.key}"
TA="${TA:-${sample_keys}/ta.key}"
OPENVPN_EXEC="${OPENVPN_EXEC:-${top_builddir}/src/openvpn/openvpn}"
MAX_CLIENTS="${MAX_CLIENTS:-10}"
CLIENT_MATCH="${CLIENT_MATCH:-Test-Client}"

# Test server configurations
SERVER_BASE_OPTS="--daemon --local 127.0.0.1 --dev tun --topology subnet --server 10.29.41.0 255.255.255.0 --keepalive 10 120 --max-clients $MAX_CLIENTS --persist-tun --verb 3 --explicit-exit-notify 3"
SERVER_CIPHER_OPTS="--cipher AES-256-CBC"
SERVER_CERT_OPTS="--ca "${CA}" --dh "${DH}" --cert "${SERVER_CERT}" --key "${SERVER_KEY}" --tls-auth "${TA}" 0"
SERVER_CONF_BASE="${SERVER_BASE_OPTS} ${SERVER_CIPHER_OPTS} ${SERVER_CERT_OPTS}"

TEST_SERVER_LIST="1 2"

SERVER_NAME_1="t_server_null_server-1194_udp"
SERVER_CONF_1="${SERVER_CONF_BASE} --lport 1194 --proto udp"

SERVER_NAME_2="t_server_null_server-1195_tcp"
SERVER_CONF_2="${SERVER_CONF_BASE} --lport 1195 --proto tcp"


# Test client configurations
CLIENT_BASE_OPTS="--client --dev null --ifconfig-noexec --nobind --remote-cert-tls server --persist-tun --verb 3 --resolv-retry 0 --connect-retry-max 3 --server-poll-timeout 1 --explicit-exit-notify 3 --script-security 2 --up null_client_up.sh"
CLIENT_CIPHER_OPTS="--cipher AES-256-CBC"
CLIENT_CERT_OPTS="--ca "${CA}" --cert "${CLIENT_CERT}" --key "${CLIENT_KEY}" --tls-auth "${TA}" 1"

TEST_RUN_LIST="1 2 3 4 5"
OPENVPN_CONF_BASE="${CLIENT_BASE_OPTS} ${CLIENT_CIPHER_OPTS} ${CLIENT_CERT_OPTS}"

TEST_NAME_1="t_server_null_client.sh-openvpn_current_udp"
SHOULD_PASS_1="yes"
OPENVPN_EXEC_1="${OPENVPN_EXEC}"
OPENVPN_CONF_1="${OPENVPN_CONF_BASE} --remote 127.0.0.1 1194 udp --proto udp"

TEST_NAME_2="t_server_null_client.sh-openvpn_current_tcp"
SHOULD_PASS_2="yes"
OPENVPN_EXEC_2="${OPENVPN_EXEC}"
OPENVPN_CONF_2="${OPENVPN_CONF_BASE} --remote 127.0.0.1 1195 tcp --proto tcp"

TEST_NAME_3="t_server_null_client.sh-openvpn_2_6_8_udp"
SHOULD_PASS_3="yes"
OPENVPN_EXEC_3="/usr/sbin/openvpn"
OPENVPN_CONF_3="${OPENVPN_CONF_BASE} --remote 127.0.0.1 1194 udp --proto udp"

TEST_NAME_4="t_server_null_client.sh-openvpn_2_6_8_tcp"
SHOULD_PASS_4="yes"
OPENVPN_EXEC_4="/usr/sbin/openvpn"
OPENVPN_CONF_4="${OPENVPN_CONF_BASE} --remote 127.0.0.1 1195 tcp --proto tcp"

TEST_NAME_5="t_server_null_client.sh-openvpn_current_udp_fail"
SHOULD_PASS_5="no"
OPENVPN_EXEC_5="${OPENVPN_EXEC}"
OPENVPN_CONF_5="${OPENVPN_CONF_BASE} --remote 127.0.0.1 11194 udp --proto udp"
